---
title: "testing"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(testthat)
test_dir(
  "./",
  env = shiny::loadSupport(),
  reporter = c("progress", "fail")
)
runTests("eric_interface", filter = "testthat")
```

## Testing

Here's just a few unit tests for our functions that are entirely programmatic.
Tests involving the user interface are handled with the shinytest package.

```{r}
test_input_a <- "foo"
test_input_b <- "foo, bar"
test_input_c <- "foo, bar\nfoobie"
test_input_d <- "foo, bar\nfoobie, doobie"
test_input_e <- "foo bar\nfoobie, doobie"

test_terms_a <- list(list("foo"))
test_terms_b <- list(list("foo", "bar"))
test_terms_c <- list(list("foo", "bar"), list("foobie"))
test_terms_d <- list(list("foo", "bar"), list("foobie", "doobie"))
test_terms_e <- list(list("foo bar"), list("foobie", "doobie"))

test_powerset_a <- "TODO" #these suck to write out by hand, do later

# these test 'ground truth urls' were generated using the ERIC api web interface
test_url_a <- "https://api.ies.ed.gov/eric/?search=%28%22foo%22%29&format=json&start=0&rows=20000&fields=%2A%20peerreviewed%3A%22T%22"
test_url_b <- "https://api.ies.ed.gov/eric/?search=%28%22foo%22%20OR%20%22bar%22%29&format=json&start=0&rows=20000&fields=%2A%20peerreviewed%3A%22T%22"
test_url_c <- "https://api.ies.ed.gov/eric/?search=%28%22foo%22%20OR%20%22bar%22%29%20AND%20%28%22foobie%22%29&format=json&start=0&rows=20000&fields=%2A%20peerreviewed%3A%22T%22"
test_url_d <- "https://api.ies.ed.gov/eric/?search=%28%22foo%22%20OR%20%22bar%22%29%20AND%20%28%22foobie%22%20OR%20%22doobie%22%29&format=json&start=0&rows=20000&fields=%2A%20peerreviewed%3A%22T%22"
test_url_e <- "https://api.ies.ed.gov/eric/?search=%28%22foo%20bar%22%29%20AND%20%28%22foobie%22%20OR%20%22doobie%22%29&format=json&start=0&rows=20000&fields=%2A%20peerreviewed%3A%22T%22"
```


### ERIC communications

```{r}
testthat::test_that(
  "ERIC urls are properly formatted", {
    expect_equal(create_eric_url(test_terms_a), test_url_a)
    expect_equal(create_eric_url(test_terms_b), test_url_b)
    expect_equal(create_eric_url(test_terms_c), test_url_c)
    expect_equal(create_eric_url(test_terms_d), test_url_d)
    expect_equal(create_eric_url(test_terms_e), test_url_e)
})
```


### Set manipulations

```{r}
testthat::test_that(
  "Parse user input of search term groups into our list of list representation", {
  expect_equal(term_powerset(test_terms_a), test_powerset_a)
})
```


### Search term input formatting

```{r}
testthat::test_that(
  "Parse user input of search term groups into our list of list representation", {
  expect_equal(format_term_input(test_input_a), test_terms_a)
  expect_equal(format_term_input(test_input_b), test_terms_b)
  expect_equal(format_term_input(test_input_c), test_terms_c)
  expect_equal(format_term_input(test_input_d), test_terms_d)
  expect_equal(format_term_input(test_input_e), test_terms_e)
})
```

